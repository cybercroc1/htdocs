<p><strong>Квоты и индексы .<br>
  <br>
</strong><strong>-- Индекс, он же Первичный Ключ (для исходных полей), он же Ключ Квоты и Первичный Ключ (для вариантов ответа).<br>
</strong>Касательно исходных полей - это список всех уникальных  значений загруженных в индексируемое поле; <br>
Для вариантов ответа - это список всех уникальных значений ключа квоты вариантов ответа.<br>
  <br>
  <strong>Индексы автоматически создаются для:</strong><br>
-- Исходных ковотируемых полей<br>
-- Исходных индексируемых полей<br>
-- Ключей квоты вариантов ответа, только для квотируемых вопросов<br>
<strong>Индексы автоматически создаются при:</strong><br>
-- Для исходных полей, при добавлении поля или установке полю признака &quot;квота&quot; или &quot;индекс&quot;.<br>
-- Для вопросов (ключей квоты вариантов ответа), при добавлении квотируемого вопроса или утановке признака &quot;квота&quot; вопросу;<br>
при добавлении вариантов ответа с новым ключем квоты (которого еще нет в индексах);<br>
  при изменении ключа квоты варианту ответа, если этот ключ окажется новым.<br>
  <strong>Индексы автоматически удаляются при:</strong><br>
  -- Удалении исходного квотируемого или индексируемого поля или снятия признаков &quot;квота&quot; и &quot;индекс&quot; с исходного поля. <br>
  -- Удалении квотируемого вопроса или снятия признака &quot;квота&quot; с вопроса.<br>
  -- Удалении вариантов ответа, если после этого в списке вариантов ответа не осталось ответов с таким же ключем квоты.<br>
  -- Изменеии ключа квоты варианта ответа, если после этого в списке вариантов ответа не осталось ответов с таким же ключем квоты.<br>
  -- Индексы по исходным полям не удаляются при удалении записей из БД. <br>
  <br>
  <strong>-- Квота</strong> -   Правило на ограничение количества успешно завершенных анкет, соответствующих условиям квоты (значениям исходных полей и(или) значениям ключей квоты вопросов анкеты).<br>
  Квоты строятся на основе индексов, поэтому удаление индексов влечет за собой удаление связанных с ними квот. <br>
  Квота считается выполненой, если количество записей соответствующих ее условию &gt;= ее значению. <br>
  Зпись отклоняется по со статусом &quot;превышена квота&quot;, если вполнена ХОТЯБЫ ОДНА из квот.<br>
  Значение квоты &quot;0&quot; означает, что для выполнения квоты нужно 0 соответствующих записей (квота выполнена изначально).<br>
  Пустое значение квоты (по умолчанию) означает бесконечное количество записей (квота не выполнится никогда).
  <br>
  <br />
  <strong>--Добавление/удаление квотируемого исходного поля, а так же утсановка/снятие признака квотируемости исходного поля</strong><br />
  В случае этих изменений проект присотанавливается. <br />
  Полностью удаляются и заново создаются все составные квоты по исходным полям и зависимые квоты по вопросам.<br />
  Заново привязываются к новым квотам все существующие в БД записи.<br />
  Пересчитывается статистика по существующим записям.
  <br />
  Меняется серийный номер квоты (старый файл квот загрузить нельзя).
  <br />
  <strong>Данная процедура может занять длительное время! </strong><br /> 
  <br />
  <strong>--Добавление (загрузка в БД) записей с новыми значениями квотируемых полей. </strong><br />
  Новые квоты и индексы по исходным полям, а также зависимые квоты по вопросам автоматически создаются при загрузке.<br />
  Выводится предупреждение о том, что необходимо прописать значения новых квот.<br />
  Серийный номер квот не меняется.<br />
  <br />
  <strong>--Удаление необработанных записей БД.</strong><br />
  Квоты и индексы по исходным полям не удаляются.<br />
  Пересчитывается статистика по квотам и индексам по исходным полям.<br />
  Квоты по вопросам не затрагиваются.<br />
  Серийный номер квот не меняется.
  <br />
  <br />
  <strong>--Добавление/удаление квотируемых вопросов, а так же установка/снятие признака квотируемости с вопроса, а так же перемена мест квотируемых вопросов<br />
  </strong>В случае этих изменений проект приостанавливается.<br />
  Удаляются и заново создаются зависимые квоты по вопросам, уровня 
  выше затронутых изменений (например, если поменять местами 2-й и 3-й квотируемые вопросы, то удалятся квоты уровней 2 и 3).<br />
  Значения квот низших уровней не пострадают.<br />
  Заново привязываются к новым квотам все выполненные записи (со статусом end_norm).<br />
  Пресчитывается статистика по успешным записям.<br />
  Меняется серийный номер квоты (старый файл квот загрузить нельзя).
  <br />
  <strong>Данная процедура может занять длительное время! </strong><br />
  <br />
  <strong>--Добавление вариантов ответа (влияние на квоты, индексы, статистику) </strong><br />
При добавлении варианта ответов, только если добавился новый уникальный ключ квоты, автоматически добавляются индексы. <br />
Квоты не создаются. Статистика не пересчитывается. <br />
Проект не приостанавливается. Выдается предупреждающее сообщение о том, что необходимо перестроить квоты по вопросам. <br />
Статистика пересчитается при перестроении квот <br />
<strong>--Удаление вариантов ответа (влияние на квоты, индексы, статистику)</strong><br />
При удалении вариантов ответа, только если был удален последний экземпляр ключа квоты удаляются квоты, индексы, статистика по не существующему ключу квоты.<br />
Удаленные варианты ответа всегда будут показываться в отчете, если есть обработанные записи с такими вариантами ответа.<br />
Обработанные записи с удаленными вариантами ответа будут считаться в статистике и учитываться в квотах, если 
  не был удален последний экземпляр ключа квоты. <br />
  <strong>--Редактирование вариантов ответа, ключа квоты
  (влияние на квоты, индексы, статистику)</strong><br />
Изменение 
  текстового или кодового значения варианта ответа никак не влияет на квоты, индексы и статистику. <br />
При изменении этих значений они изменятся и в отчетах за весь предшествующих изменению период.<br />
При изменении ключа квоты, если при этом добавился или удалился
  уникальный экземпляр ключа квоты, то происходит тоже самое, что и в предыдущих 2-х пунктах соответственно.<br />
При любом изменении ключей квоты. Проект не приостанавливается, выдается сообщение о необходимости пересчитать статистику по квотам по вопросам. <br />
  <br>
  <strong>--
  Квоты по исходным полям.</strong> Составные квоты из одного или нескольких полей.<br>
  Формируется из всех найденных вариаций значений, загруженных в квотируемые исходные поля.<br>
  Например:<br>
  в исходные квотируемые поля &quot;Город&quot; и &quot;Тип телефона&quot;, загружены 4 строки:<br>
  1. Москва; Стационарный<br>
  2. Москва; Стационарный<br>
  3. Москва; Мобильный<br>
  4. СПБ; стационарный<br>
  по этим данным сформируются 3 составные квоты по исходным полям:<br>
  1. Москва; Стационарный <br>
  2. Москва; Мобильный<br>
  3. СПБ; Стационарный <br>
  квоты по остальным возможным комбинациям, которых нет в загруженных данных (в этом примере &quot;СПБ; Мобильный&quot;), сформированы не будут.<br>
  Что бы сформировать квоты по не существующим комбинациям данных, создайте файл со всеми необходимыми комбинациями, загрузите его в БД, а потом удалите эту загрузку, сформированные квоты не удалятся.<br>
  <strong><br>
  -- Зависимые квоты (по исходным полям и вопросам) </strong><br>
  Концепция такова, что все данные по исходным полям загруженные в БД, известны до начала проведения опроса и порядок исходных полей не влияет на зависимые квоты, их (поля) можно менять местами.<br>
  От квот по исходным полям зависит подача записей оператору (алгоритм подачи записей). <br>
  Ответы на вопросы заранее не звестны и могут быть получены только во премя проведения опроса и только в той последовательности, в которой они идут в анкете, поэтому порядок квотируемых вопросов влияет на формирофание древовидной структуры зависимых квот. <br>
  Зависимые квоты формруются из всех составных квот по исходным полям, если они есть (Уровень квоты &quot;0&quot;), всех найденных вариаций ключей квоты по квотируемым вопросам в той последовательности, в которой они идут в анкете. <br>
  Т.е. составные квоты по исходным полям всегда будут иметь уровень &quot;0&quot;; <br>
  Зависимые квоты по составным квотам по исходным полям и 1-му вопросу - уровень &quot;1&quot;;<br>
  Зависимые квоты по составным квотам по исходным полям, 1-му вопросу и 2-му вопросу - уровень &quot;2&quot;<br>
  и т.д. <br>
  Кличество зависимых квот будет равным: (кол-во составных квот по исходным полям) * (кол-во уникальных значений ключа квоты (индексов) по первому вопросу) * (кол-во уникальных значений ключа квоты (индексов) по первому вопросу) и т.д. <br>
  <br>
  -- Удаление или отмена одного или нескольких исходных квотируемых полей; <br>
  -- Удаление 
  или отмена одного или нескольких квотируемых вопросов; <br>
  -- Перемена мест любых квотируемых вопросов;<br>
  -- Добавление или установка признака квотируемости одного или нескольких вопросов;<br>
  Влекут за собой полное удаление всех квот, приостановку проекта и необходимость заново сформировать квоты и прописать их значения.<br>
  <br>
  <strong>-- Независимые квоты по исходным полям</strong><br>
  Позволяют установить независимую квоту для каждого уникального значения (индекса) квотируемого или индексируемого исходного поля. <br>
  <br>
  <strong>-- Независимые квоты по вопросам </strong><br>
  Позволяет установить независимую квоту для каждого уникального значения (индекса) ключа квоты квотируемого вопроса.
  <br />
  <br />
  <strong>-- Редактирование значений квот</strong><br />
  Редактирование значений квот производится путем экпорта/редактирования/импорта файла Microsoft EXCEL.<br />
  Добавлять новые квоты через файл нельзя, можно только редактировать значения существующих. Чтобы добавить новые квоты загрузите в исходные поля необходимые данные или создайте вопрос с необходимыми ключами квоты.<br /> 
  После импорта значения квот пересчитываются исходя из логики: &quot;значение родительской квоты не может быть больше суммы значений всех дочерних&quot;. <br />
  <strong>-- Экспорт.</strong><br />
  Экспорт производится на странице &quot;Квоты&quot; кнопкой &quot;экспорт в XLSX&quot;, файл сохраняется средствами браузера в стандартной для загрузок папке под именем &quot;Квоты(название проекта).xlsx&quot;.<br />
  <strong>-- Редактирование.</strong><br />
  Файл содержит несколько листов, каждый для своего типа квоты. <br />
  Ключевыми моментами являются:<br />
  Названия листов
  - по ним импорт определяет тип квоты<br />
  Номер строки, где находится шапка таблицы, фиксорованно, строка №2 <br />
 Слово &quot;Квота&quot; в шапке таблицы - по этому слову импорт определяет столбец, в котором записано значение квоты<br /> 
 Столбец,  содержащий идентификатор квоты, фиксированно, столбец &quot;А&quot;, этот столбец скрыт.<br />
 Ячейка &quot;А1&quot;, содержащая серийный номер квоты. Серийный номер квоты меняется, когда меняются настройка квотируемых полей и вопросов.
 <br />
 <strong>-- Импорт.</strong><br />
 Для защиты от случайной загрузки &quot;чужих&quot; квот имя файла импорта должно содержать название проекта, если это не так, то импорт выдаст ошибку.<br />
 Для защиты от загрузки старого файла квот с не актуальными идентификаторами и возможности установить не верные значения при зугрузке проверяется серийный номер квот, если номер не совпадает с текущим импорт выдаст ошибку. <br />
 По результатам импорта отоброзится лог.
 <br /> 
 <br />
  <br>
</p>
