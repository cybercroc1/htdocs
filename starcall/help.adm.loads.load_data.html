<p><strong> Загрузка данных в БД.</strong><br />
  <strong><br />
  Требования к загружаемому файлу.</strong><br />
  -- .txt или .csv файл в кодировке windows-1251. <br />
  -- Разделитель полей: [;]; ограничитель текста: [&quot;] (ограничитель текста не обязателен и нужен только тогда, когда в ячейке встречаются символы разделителя [;] и переноса строки). <br />
  -- Первая строка должна содержать названия полей.<br />
-- Названия полей не дожны быть пустыми, при загрузке поле с пустым названием игнорируется.<br />
<strong><br />
Стандартные поля БД.</strong><br />
  -- При первой загрузке БД в рамках нового проекта, а так же при последующей догрузке, если при этом создаются новые поля в БД <br />
  <strong>НЕОБХОДИМО</strong> выбрать соответсвие загружаемых полей стандартным полям для последующей организации хранилища даннх. <br />
  -- В рамках одного проекта нельзя задать соответствие одного стандартного поля нескольким загружаемым, такое действие вызовет ошибку. <br />
  -- После первой загрузки в рамках проекта соответствие стандартным полям задать можно, но поменять нельзя.<br />
  <br />
  <strong>Фичи.</strong><br />
  -- При певой загрузке и дозагрузке, если файл имеет большее ко-во полей, чем в БД в рамках одного проекта поля в БД автоматически создаются и именуются так же, как они заданы в файле. <br />
  -- Самообучение стандартным полям. Соответствие стандартным полям выставляется автоматически по сложному алгоритму исходя из спика синонимов, который формируется в результате предыдущих загрузок. Т.к. этот алгоритм теоретический и не имеет практического опыта работы сопоставление стандартных полей <strong>НЕОБХОДИМО КОНТРОЛЛИРОВАТЬ</strong> визуально при каждой загрузке, для дальнейшей отладки. Более подробно алгоритм описан в комментариях к исходному коду. <br />
  -- При последующих дозагрузках, если названия полей в файле совпадают с названиями полей в БД или названиями полей предыдущего загруженного файла или одним из синонимов стандартных полей (если такое стд. поле есть в базе) всё независимо от регистра,  <s>то порядок полей в БД автоматически выстраивается в соотвествии с порядком полей в файле 
  (т.е. загружаемым файлом можно поменять порядок полей в БД)</s> то порядок полей в файле автоматически выстраивается в соответствии с порядком полей в БД.
Этот порядок можно поменять перетаскивая мышкой поля файла или поля БД по своему усмотрению, но нужно помнить, что если поменять порядок полей в БД, этот прядок поменяется и в отчетах и в интерфейсе оператора. <br />
-- Расчет приблизительного времени загрузки файла. Прогнозирование времени загрузки производится на основе среднего арифметического длительности всех предыдущих загрузок в зависимости от размера всех загруженных файлов (в байтах). По опыту тестирования на него вполне можно ориентироваться при загрузке больших файлов. <br />
<br />
  <strong>Глюки.</strong><br />
  -- в Хроме не работает ссылка на файл с ошибкими, нужно копировать и вставлять в проводник вручную.<br />
  -- в IE ниже 11-го и в 11-м в режиме совместимости не правильно работает добавление полей и перетаскивание полей мышкой <br />
  <strong><br />
  Отмена загрузки.</strong><br />
  -- Начатую загрузку можно прервать, при этом записи,которые успели загрузиться останустся.. <br />
  -- В один момент времени может происходить только одна загрузка. При попытке совершить загрузку пока не завершилась предыдущая, программа выдаст ошибку.
  <strong><br />
  <br />
  Обязательность и уникальность.</strong><br />
  -- При первой загрузке БД в рамках нового проекта, а так же при последующей догрузке, если при этом создаются новые поля в БД полям можно задать признаки уникальности и обязательности.<br />
  Эти опции можно менять в разделе настроек исходных полей. Если их поменять в непустой БД, тогда при каждой последующей загрузке будут применяться измененные правила проверки обязательности и уникальности, но на существующие в БД данные она не повлияет. <br />
  <br />
  <strong>Обязательность.</strong><br />
  -- Можно установить для одного или нескольких полей - это означает, что данные поля не должны быть пустыми. Обязательность проверяется только во время загрузки данных. <br />
  -- При попытке загрузить пустое обязательное поле, строка отклоняется, выводится ошибка с номером строки и продолжается загрузка.<br />
  <br />
  <strong>Уникальность.</strong><br />
  -- Можно установить для одного или нескольких полей. <em><strong>Уникальность проверяется ТОЛЬКО в момент загрузки в соответствии с текущими настройками исх. полей. Уникальность не ограничивается текущей загрузкой, а проверяется в рамках всего проекта и загружаемого файла.</strong></em><br />
  -- Для проверки уникальности можно выбрать одно из условий: <br />
&quot;и&quot; (по умолчанию), означает, что будет отклонена строка, если в БД есть запись, совпадающая по всем уникальным полям;<br />
&quot;или&quot; - отклоняется запись, совпадающая хотябы по одному уникальному полю.<br />
-- Пустые поля в проверке уникальности не участвут и игнорируются, т.е. в БД можно загрузить записи с пустыми уникальными полями, что бы этого избежать используйте опцию &quot;Обязательность&quot;.<br />
  <strong>ВНИМАНИЕ!</strong> Проверка уникальности может занять длительное время и зависит от количества уникальных полей и многих других факторов. <br />
  Она точно не зависит от размера загружаемого файла, поэтому, если есть сомнения рекомендую проверить скорость загрузки на небольшом куске файла.<br />
  <br />
  <strong>Поле &quot;Телефон&quot; (PHONE). </strong><br />
  -- Поле, содержащее номера телефона определяется загрузчиком, если ему назначено соответствие стандарному полю &quot;Телефон&quot; (PHONE) .<br />
  -- Поле, содержащее телефоны  может быть только одно.<br />
  -- Поле может содержать один или несколько номеров телефона в произвольном формате, разделенные [,] или [;] или табуляцией или переводом мтроки.<br />
  -- При загрузке поля &quot;Телефон&quot; обработчик  разбивает найденные  телефоны, приводит их к единому формату: 8хххххххххх или 810хххххххххх..., сохраняет в отдельную связанную таблицу.<br />
  -- Символ &quot;#&quot; отделяет добавочный номер от номера телефона, добавочный номер записывается в отдельное поле связанной таблицы с телефонами. Добавочный номер записывается без модификации, как есть, единственное ограничение на доб номер - это количество знаков не должно быть более 25.<br />
  -- Если добавочный номер длиннее 25 знаков - это приравнивается к ошибочному и телефон с таким добавочным не грузится.
  <br />
  При этом исходное представление телефонов тоже сохраняется наряду с остальными полями.<br />
  --Любые нецифровые символы, кроме &quot;+&quot;, а так же написание добавочных номеров в поле &quot;Телефон&quot; игнорируются и не имеют смысла, кроме необходимости сохранения исходного представления  данных для визуального прочтения.<br />
-- Пример строки с правильным написанием телефонов: &quot;89251234567; +7(925)123-45-67, тел. +7 925 123 45 67, 7(495)1234567 #555; 8-10-1-12345678901 (США) #555, +112345678901 - Джон: #555&quot;.&nbsp;<br />
<br />
<strong>Обязательность поля &quot;Телефон&quot; (PHONE).</strong><br />
-- Если поле &quot;Телефон&quot; отмечено, как обязательное, то даже если оно содержит данные, но обработчику не удалось найти в них ни одного телефонного номера звапись отклоняется с ошибкой &quot;не удалось найти телефон&quot;, а в статистике считается пустой строкой. <br />
<br />
<strong>Уникальность поля &quot;Телефон&quot; (PHONE). </strong><br />
--  Если поле &quot;Телефон&quot; отмечено, как уникальное, уникальность проверяется по исходному представлению наряду с остальными полями.<br />
-- Кроме того уникальность проверяется для каждого найденного номера в отдельности, и если один или несколько номеров совпали, то совпавшие номера отклоняются с ошибкой &quot;дубл. телефон&quot;, при этом запись с неизменным исходным представлением грузится в БД. Если же совпали все найденные номера, то отклоняется вся запись с ошибкой - &quot;дубликат&quot;.<br />
<br />
<strong>Поле &quot;Добавочный номер&quot; (PHONE_EXT).</strong><br />
-- Данное стандартное поле будет присоединять добавочный номер к телефону, только если для записи найден всего один номер телефона. <br />
-- Если при загрузке выбрано данное поле и оно имеет не пустое значение, то будет проверяться количетво найденных телефонов, и, если ко-во телефонов &gt; 1 или длина значения добавочного номера &gt;25 знаков, то запись отклоняется с ошибкой.<br />
-- Если у записи нет телефонов, то проверка игнорируется, а поле загружается, как обычное. <br />
-- Если наряду со стандартным полем PHONE_EXT добавочный номер найден так же в поле &quot;Телефон&quot; (через #), то к телефону присоединяется найденный, а добавочный из стандартного поля остается наряду с исходными полями справочно.<br />
-- Присоединенный к телефону добавочный не может содержать символов &quot;,&quot;,&quot;;&quot;, табуляция, перевод строки, т.к. эти символы являются разделителем телефонов при загрузке. При ручнном вводе добавочного при установке статуса &quot;перезвон&quot;, и при присоединении добавочного из стандартного поля PHONE_EXT эти символы заменяются на символ &quot;&amp;&quot;, а при отображении добавочного оператору символ &quot;&amp;&quot; заменяется на &quot;,&quot;. <br />
<br />
  <strong>Поле &quot;Часовой пояс (МСК)&quot;.</strong><br />
  Значение этого поля при загрузке проверяется на валидность, это должно быть положительное или отрицательное число от -15 (Кваджалейн) до +11 (о. Киритимати) с десятичным разделителем &quot;.&quot; или &quot;,&quot;. Наприм: &quot;-2&quot;,&quot;1&quot;,'+1&quot;,&quot;+2,75&quot;,&quot;+12.5&quot;. Если проверка не проходит, то строка отклоняется с ошибкой &quot;Не верный часовой пояс&quot;. <br />
  Может быть пустым, если полю не установлен признак обязательности.<br />
  Исходя из часового пояса задаются временные рамки для опроса с учетом регионального времени. <br />
  <br />
  <strong>&quot;Требует проверки роботом&quot;</strong> - если при загрузке выбрана эта опция, то все загружаемые записи и все найденные в них телефоны будут запрещены для обработки оператором. Если эта опция не выбрана, то все загружаемые записи бедет одобрены. <br />
  Одобрить заблокированные записи можно вручную или импортом успешных результатов из робота в разделе &quot;Менеджер загрузок&quot; (см.  справку соответствующего раздела).<br />  
  <br />
  <strong>Ошибки при загрузке.</strong><br />
  <strong>Ошибки, возникающие перед загрузкой отменяющие загрузку и дающие повторные попытки без повторного выбора загружаемого фала: </strong><br />
  -- &quot;ОШИБКА: Нечего сохранять&quot;<br />
  -- &quot;ОШИБКА: Не завершена предыдущая загрузка. Попробуйте позже.&quot;<br />
  -- &quot;ОШИБКА: Пустое имя или кодовое имя поля (id:$id)&quot;<br />
  -- &quot;ОШИБКА: Квотируемое поле $base_fields_text_name[$id] (id:$id) должно быть обязательным и не уникальным&quot;<br />
  -- &quot;ОШИБКА: Обязательному полю $base_fields_text_name[$id] (id:$id) сопоставлено пустое поле файла&quot;<br />
  -- &quot;ОШИБКА: Дублируется имя поля $base_fields_text_name[$id] (id:$id)&quot;<br />
  -- &quot;ОШИБКА: Дублируется кодовое имя поля $base_fields_code_name[$id] (id:$id)&quot;<br />
  -- &quot;ОШИБКА: Дублируется стандартное поле $base_fields_std_name[$id] (id:$id)&quot;<br />
  -- &quot;ОШИБКА: Нечего грузить&quot;<br />
  -- &quot;ОШИБКА: Нет смысла требовать проверки роботом для БД без поля &quot;Телефон&quot; - возникает, если выбрана соответствующая опция загрузки, но при этом в БД отсутствует поле &quot;Телефон&quot; или этому полю сопоставлено пустое поле файла.<br />
  -- &quot;ОШИБКА: Индексируемое поле $base_fields_text_name[$id] (id:$id) не должно быть уникальным&quot;<br />
  -- &quot;ОШИБКА: Нельзя называть поле зарезервированным словом &quot;Квота&quot; <br />
  <br />
  <strong>Предупреждения, позволяющие продолжить или отменить загрузку.<br />
  </strong>-- &quot;ПРЕДУПРЕЖДЕНИЕ: Нет смысла индексировать квотируемое поле $base_fields_text_name[$id] (id:$id). Признак &quot;Индекс&quot; с этого поля снят.&quot; - квота предполагает индексацию.<br />
  -- &quot;ПРЕДУПРЕЖДЕНИЕ: Не задано поле Телефон (PHONE).&quot; - Это предупреждение выдается, если в БД отсутствует стандартное поле &quot;Телефон&quot; или этому полю при загрузке сопоставлено пустое поле файла.<br />
  -- &quot;ПРЕДУПРЕЖДЕНИЕ: Изменилось количество ковтируемых полей. Если продолжить сохранение, то проект будет приостановлен, а квоты, включая зависимые квоты по вопросам придется перестроить и прописать значения заново.&quot;<br />
  <br />
  <strong>-- Ошибки, возникающие в процессе загрузки, отклоняющие конкретную строку или номер телефона и не прерывающие выполнения загрузки:</strong><br />
  -- &quot;пустая строка.&quot; - строка не содержит данных<br />
  -- &quot;пустое обяз. поле.&quot; - одно из полей, отмеченных, как обязательное - пустое. В статистке загрузки эта ошибка приравнивается к пустым строкам.<br />
  -- &quot;не верный часовой пояс&quot; - данные в этом поле не являются валидным числом для часового пояса. <br />
  -- &quot;не удалось найти телефон&quot; - поле &quot;Телефон&quot;, отмеченное, как обязательное содержит данные, но обработчику не удалось найти в них ни одного телефона. В статистике приравнивается к пустым строкам. <br />
  -- &quot;дубликат по уникальному полю(ям).&quot; - нарушено ограничение уникальности в соответсвии с выбранными настройками.<br />
  -- &quot;дубл. телефон&quot; - дубликат телефона в пределах одной ячейки (отклоняется телефон) <br />
  -- &quot;дубл. телефон в БД&quot; - дубликат телефона в пределах БД (отклоняется телефон) <br />
  -- &quot;дубл. по всем номерам&quot;  - дубликат по всем номерам телефона в ячейке (отклоняется строка) <br />
  -- &quot;не верный телефон&quot; - не удалось привести телефон к нормальному виду, такие телефоны не участвуют в статистике &quot;найден телефон&quot;.<br />
  -- &quot;доб.номер не применим для нескольких телефонов&quot; - если в записи найдено более одного номера телефона, и при этом есть добавочный номер, строка отклоняется, т.к. не понятно к какому номеру привязывыать эктеншн. <br />
  -- &quot;слишком длинный доб.номер (до 25 зн.)&quot; - нельзя привязать к номеру телефона добавочный номер длинее 25 знаков <br />
  -- Другие непредвиденные ошибки полностью останавливают процесс загрузки, данные, которые успели загрузиться до возникновения ошибки остаются в БД, загрузка помечается как прерванная (aborted) через 1 минуту. <br />
  -- Прерванные загрузки можно посмотреть и удалить в разделе &quot;менеджер загрузок&quot;. <br />
  <br />
</p>
